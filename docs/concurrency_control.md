## 비즈니스 요구사항에 따른 동시성 제어 방안

### 1. 포인트 조회

- 기존
    - 비관적 락 적용
- 개선
    - 낙관적 락 사용
        - 사용이유 - 접근하는 자원에 대한 사용자가 한정적(사용자 본인)이므로 상대적으로 경합이 낮을것으로 예상
        - 사용방법 - Spring jpa의 @Version 을 사용하여 데이터 수정 시 Version 필드를 확인하여 값이 일치하지 않으면 처리하는 방식으로 사용

### 2. 선착순 쿠폰 발급

- 기존
    - 비관적 락 적용
- 개선
    - Redis의 Pub/Sub 분산 락 사용
        - 사용이유 - 많은 사용자들이 같은 자원에 몰리므로 잦은 경합이 발생할 것으로 예상,
        - Redisson 사용이유 - Redis의 setnx, setex 등 의 직접구현이 아닌 의 Lock 인터페이스를 사용하는 방식으로 해결할 수 있음, Lettuce의 스핀락 방식이 아닌 Pub/Sub으로 Redis의 부하가 줄어듬
        - 사용방법 - 락 획득 시 Redis 키를 설정하여 해당 락이 점유상태 일 시 Redis 키의 채널을 구독하여 락 해제 호출을 듣고 락을 점유함
        - 주의사항 - 락과 트랜잭션은 데이터의 무결성을 보장하기 위해
          - 락 획득 -> 트랜잭션 시작 -> 로직 수행 -> 트랜잭션 종료 -> 락 해제
          - 순서를 지켜야 함

### 3. 상품 재고차감

- 기존
    - 비관적 락 적용